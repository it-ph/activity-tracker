angular.module("employeeTracker").controller("AccountController",["$rootScope","$cookies","$scope","$state","AccountDataOp","EmployeeDataOp","Access",function(e,t,c,o,n,s,a){function u(){n.getAccountList().then(function(e){c.itemList=e.data,c.totalItems=c.itemList.length;var t=(c.currentPage-1)*c.numPerPage,o=t+c.numPerPage;c.filteredList=c.itemList.slice(t,o)}).catch(function(e){console.log(e)})}function r(){c.totalItems=c.itemList.length;var e=(c.currentPage-1)*c.numPerPage,t=e+c.numPerPage;c.filteredList=c.itemList.slice(e,t)}c.itemList=[],c.filteredList=[],c.item={},c.newItem={},c.selectedItem={},c.employeeList=[],c.selectedEmployee={},c.roleList=[],c.totalItems=null,c.currentPage=1,c.maxSize=5,c.numPerPage=10,c.search_keyword="",c.employee_search="",c.error="",c.success_msg="",c.numPerPageCap=[10,25,50,100],c.pageCap=c.numPerPageCap[0],c.numPerPage=c.numPerPageCap[0],c.newItem={user:{role:{}},employee:{}},token=t.get("tracker-token"),c.changeNumPerPage=function(){c.numPerPage=c.pageCap,r()},void 0==token?o.go("landing"):a.getClaimsFromToken(token).then(function(e){data=e.data,data.authenticated&&(a.user(data.principal.user),"ADMIN"!=data.principal.user.role.role&&o.go("home"))}).catch(function(e){t.remove("tracker-token"),a.user(void 0),o.go("landing")}),u(),c.loadAccount=function(){s.getEmployeeList().then(function(e){c.employeeList=e.data}).catch(function(e){console.log(e)}),n.getRoleList().then(function(e){c.roleList=e.data,c.newItem.user.role=c.roleList.length>0?c.roleList[0]:{}}).catch(function(e){console.log(e)})},c.search=function(){},c.setPage=function(e){c.currentPage=e},c.pageChanged=function(){var e=(c.currentPage-1)*c.numPerPage,t=e+c.numPerPage;c.filteredList=c.itemList.slice(e,t)},c.setSelectedItem=function(e){c.selectedItem=e},c.addAccount=function(){n.addAccount(c.newItem).then(function(e){c.success_message="User account added succesfully!",$("#add-account").modal("hide"),$("#successModal").modal("show"),setTimeout(function(){$("#successModal").modal("hide")},3e3),c.error="",u()}).catch(function(e){console.log(e),c.error=e.data.message})},c.updateAccount=function(){n.updateAccount(c.selectedItem).then(function(e){c.success_message="User account updated succesfully!",$("#edit-task").modal("hide"),$("#successModal").modal("show"),setTimeout(function(){$("#successModal").modal("hide")},3e3),c.error="",u()}).catch(function(e){console.log(e),c.error=e.data.message})},c.disableAccount=function(e){n.disableAccount(e).then(function(e){c.success_message="Account disabled succesfully!",$("#successModal").modal("show"),setTimeout(function(){$("#successModal").modal("hide")},3e3),c.error="",u()}).catch(function(e){c.error=e.data.message})},c.enableAccount=function(e){n.enableAccount(e).then(function(e){c.success_message="Account enabled succesfully!",$("#successModal").modal("show"),setTimeout(function(){$("#successModal").modal("hide")},3e3),c.error="",u()}).catch(function(e){c.error=e.data.message})},c.resetAccount=function(e){n.resetAccount(e).then(function(e){c.success_message="Password reset succesfully!",$("#successModal").modal("show"),setTimeout(function(){$("#successModal").modal("hide")},3e3),c.error="",u()}).catch(function(e){c.error=e.data.message})}}]);