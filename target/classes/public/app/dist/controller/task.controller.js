angular.module("employeeTracker").controller("TaskController",["$rootScope","$cookies","$scope","$state","TaskDataOp","Access",function(e,t,a,n,s,o){function c(){s.getTaskList().then(function(e){a.itemList=e.data,a.totalItems=a.itemList.length;var t=(a.currentPage-1)*a.numPerPage,n=t+a.numPerPage;a.filteredList=a.itemList.slice(t,n)}).catch(function(e){console.log(e)})}function r(){a.totalItems=a.itemList.length;var e=(a.currentPage-1)*a.numPerPage,t=e+a.numPerPage;a.filteredList=a.itemList.slice(e,t)}token=t.get("tracker-token"),void 0==token?n.go("landing"):o.getClaimsFromToken(token).then(function(e){data=e.data,data.authenticated&&(o.user(data.principal.user),"ADMIN"!=data.principal.user.role.role&&n.go("home"))}).catch(function(e){t.remove("tracker-token"),o.user(void 0),n.go("landing")}),a.itemList=[],a.filteredList=[],a.item={},a.newItem={},a.selectedItem={},a.totalItems=null,a.currentPage=1,a.maxSize=5,a.numPerPage=10,a.search_keyword="",a.error="",a.success_msg="",a.numPerPageCap=[10,25,50,100],a.pageCap=a.numPerPageCap[0],a.numPerPage=a.numPerPageCap[0],a.changeNumPerPage=function(){a.numPerPage=a.pageCap,r()},c(),a.search=function(){},a.setPage=function(e){a.currentPage=e},a.pageChanged=function(){var e=(a.currentPage-1)*a.numPerPage,t=e+a.numPerPage;a.filteredList=a.itemList.slice(e,t)},a.setSelectedItem=function(e){a.selectedItem=e},a.addTask=function(){s.addTask(a.newItem).then(function(e){a.success_message="Task added succesfully!",$("#add-task").modal("hide"),$("#successModal").modal("show"),setTimeout(function(){$("#successModal").modal("hide")},3e3),a.error="",c()}).catch(function(e){console.log(e),a.error=e.data.message})},a.editTask=function(){s.updateTask(a.selectedItem).then(function(e){a.success_message="Task updated succesfully!",$("#edit-task").modal("hide"),$("#successModal").modal("show"),setTimeout(function(){$("#successModal").modal("hide")},3e3),a.error="",c()}).catch(function(e){console.log(e),a.error=e.data.message})}}]);