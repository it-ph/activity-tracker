angular.module("employeeTracker").controller("EmployeeTaskController",["$rootScope","$cookies","$scope","$state","TaskDataOp","Access",function(e,t,s,a,n,o){function c(){n.getMyTaskList(token).then(function(e){s.itemList=e.data,s.itemList.length>0&&(null==s.itemList[0].endDate?$("#add-task-btn").prop("disabled",!0):$("#add-task-btn").prop("disabled",!1)),s.totalItems=s.itemList.length;var t=(s.currentPage-1)*s.numPerPage,a=t+s.numPerPage;s.filteredList=s.itemList.slice(t,a)}).catch(function(e){console.log(e)})}token=t.get("tracker-token"),void 0==token?a.go("landing"):o.getClaimsFromToken(token).then(function(e){data=e.data,data.authenticated&&o.user(data.principal.user)}).catch(function(e){t.remove("tracker-token"),o.user(void 0),a.go("landing")}),s.success_message="",s.itemList=[],s.filteredList=[],s.item={},s.totalItems=null,s.currentPage=1,s.maxSize=5,s.numPerPage=10,s.search_keyword="",s.error="",s.success_msg="",c(),o.showNav(!0),s.search=function(){},s.setPage=function(e){s.currentPage=e},s.pageChanged=function(){var e=(s.currentPage-1)*s.numPerPage,t=e+s.numPerPage;s.filteredList=s.itemList.slice(e,t)},s.endTask=function(e){n.endEmployeeTask(token,e).then(function(e){s.success_message="Task ended!",$("#add-task").modal("hide"),$("#successModal").modal("show"),setTimeout(function(){$("#successModal").modal("hide")},3e3),c()}).catch(function(e){console.log(e)})},s.taskList=[],s.selectedTask={},s.loadTask=function(){n.getTaskList().then(function(e){s.taskList=e.data,s.selectedTask=s.taskList.length>0?s.taskList[0]:{}}).catch(function(e){console.log(e)})},s.loadTask(),s.addTask=function(){n.addEmployeeTask(token,s.selectedTask).then(function(e){s.success_message="New task started!",$("#add-task").modal("hide"),$("#successModal").modal("show"),setTimeout(function(){$("#successModal").modal("hide")},3e3),c(),console.log(e)}).catch(function(e){console.log(e)})}}]);